Release date of the file: 24-11-2015 
Status: OK

Project:
Search engine for Point Of Interest with a content access module mechanism to extend to additional sources of data
This project is one of the navigation-service common projects that implements the GENIVI navigation APIs.

More:
The project is made of four parts:
- poi-supplier that populates a sqlite3 based database from OSM data in xml format (you need -DWITH_DATABASE_SUPPLIER=ON)
- poi-server that implements the poi search API and access an embedded database
- poi-contentaccess-module that implements a content access module that access an additional database, and a simple HMI 
- poi-client that implements a client with a test HMI 
See also other navigation projects like navigation or proof of concepts implemented for traffic-info and positioning 

What is in:
This folder contains scripts for building poi-supplier, poi-contentaccess-module and poi-client, generating the databases and launching the whole stuff (build poi-server if necessary)
FYI: poi-server is located under src/poi-service

Author: 
Philippe Colliot philippe.colliot@mpsa.com

License: 
See headers and LICENSE file (mainly MPL V2)

Test target: 
Ubuntu 14.04 LTS 32bits
Ubuntu 15.10 64bits

Qt version:
Qt5 (to get the version -> qtchooser -print-env, to set the version -> export QT-SELECT=<version>)

To get the code:
Code is part of the navigation-service repository, so you need to clone all:
git clone http://git.projects.genivi.org/lbs/navigation-service.git $WORKING-DIR
 
Important notice before building the POC:
# The software is using stream conversion, so please care if your local settings are right
# There could be a potential runtime error due to a wrong sql request (problem with the use of ',' in place of '.')
# so, if you enter 
locale | grep 'LC_NUMERIC' 
# you must get
LC_NUMERIC="en_US.UTF-8"

===============================
Current versions of additional code 
===============================
<current version of positioning> (git): 32f9e5ce48f76c5c9833dda0e1743ab8b45dc574

===============================
How to get additional code 
===============================
Get positioning:
git clone http://git.projects.genivi.org/lbs/positioning.git ./positioning
cd positioning
git checkout <current version of positioning>
cd ../

===============================
How To Build
===============================
(you're supposed to have got additional code before)

Create and enter the build folder:
mkdir ./build
cd build

Build:
cmake ../
make
cd ..

===============================
How To Prepare the database and the configuration for a country
===============================
NB: You need to build the poi-supplier first:
cd build
cmake -DWITH_DATABASE_SUPPLIER=ON ../
make
cd ..

To launch the stuff for Paris:
./prepare -c paris

NB:
As examples, three databases can be generated for Paris, Tokyo and San-Diego
The input stuff is taken from the OSM, by using this site:
http://www.overpass-api.de

For instance, in Paris area, the bounding box used for the demo is
bbox=2.246304,48.814551,2.430325,48.901289
In case we want to get the hotels and the museums located inside the area defined, request is:
http://www.overpass-api.de/api/xapi?*[bbox=2.246304,48.814551,2.430325,48.901289][tourism=museum|hotel]
for the stations:
http://www.overpass-api.de/api/xapi?*[bbox=2.246304,48.814551,2.430325,48.901289][railway=station]
for the bicycle
http://www.overpass-api.de/api/xapi?*[bbox=2.246304,48.814551,2.430325,48.901289][shop=bicycle]
for the fuel stations
http://www.overpass-api.de/api/xapi?*[bbox=2.246304,48.814551,2.430325,48.901289][amenity=fuel]

For Tokyo, the bounding box is 139.691048,35.631628,139.832497,35.738153

NB: In case you get such error message during runtime:
D-Bus library appears to be incorrectly set up; failed to read machine uuid: Failed to open "/etc/machine-id": No such file or directory
You need to fix it by:
sudo su
dbus-uuidgen  > /etc/machine-id

===============================
How To Run
===============================

./run 

===============================
How To Build poi-common-manager-client (experimental)
===============================
First you need to build the poi-manager-server, see the README in ../../src/poi-service

cd build

You need to pass as parameter to the cmake the link to your patched dbus library (required by CommonAPI)

cd build
cmake -DWITH_FRANCA_DBUS_INTERFACE=ON -DDBUS_LIB_PATH=yourPath -DCOMMONAPI_DBUS_TOOL_DIR=<common-api-dbus-tools folder> -DCOMMONAPI_TOOL_DIR=<common-api-tools folder> -DWITH_DEBUG=ON ../

make

===============================
How To Run
===============================

Launch the server (into ../../src/poi-service)

Copy the configuration file ./resource/commonapi-dbus.ini in a directory of your choice
Set the environment variable COMMONAPI_DBUS_DEFAULT_CONFIG before starting the poi-manager-server.
Example:
export COMMONAPI_DBUS_DEFAULT_CONFIG=<your path>/commonapi-dbus.ini
cp ./resource/poi-database-managed.db ./bin
./bin/poi-manager-server -f ./bin/poi-database-managed.db
poi manager server started

Launch the client
./bin/poi-manager-client -t
poi manager client started

What is logged (no DLT started):

DLT| WARNING:   Loging disabled, FIFO /tmp/dlt cannot be opened with open()!
[CAPI][INFO] Using default binding 'dbus'
[CAPI][INFO] Using default shared library folder '/usr/local/lib/commonapi'
[CAPI][INFO] Using default configuration file '/etc/commonapi.ini'
[CAPI][DEBUG] Registering factory for binding=dbus
poi manager server started

DLT| WARNING:   Loging disabled, FIFO /tmp/dlt cannot be opened with open()!
[CAPI][INFO] Using default binding 'dbus'
[CAPI][INFO] Using default shared library folder '/usr/local/lib/commonapi'
[CAPI][INFO] Using default configuration file '/etc/commonapi.ini'
[CAPI][DEBUG] Registering factory for binding=dbus
poi manager client started
Version 1.0.0
Date 19-03-2015
languageCode: eng countryCode: USA scriptCode: Latn 
Configuration changed:  0
Change locales
languageCode: fra countryCode: FRA scriptCode: Latn 
id: 0 name: all categories top level: 1

Create category

Category 1 created
id: 0 name: all categories top level: 1
id: 1 name: recreation top level: 1

Create POI

POI 1 added

Search

Search state 1298
Result list size 1
POI id 1

Delete POI

POI 1 removed

Delete category

Category 1 removed
id: 0 name: all categories top level: 1

Exit
poi manager client closed
DLT| ERROR:     Lost log messages in user buffer when exiting: 2



